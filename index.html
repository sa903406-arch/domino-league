<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¯ÙˆÙ…Ù†Ø© Ø§Ù„Ù…Ù„ÙƒÙŠ</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">

<style>
:root{
 --primary:#1e3c72;--secondary:#2a5298;--gold:#fbc02d;
 --silver:#bdc3c7;--bronze:#cd7f32;--bg:#f0f2f5;
 --success:#27ae60;--danger:#e74c3c;
}
body{font-family:Cairo;background:var(--bg);margin:0;padding-bottom:70px}
header{background:linear-gradient(135deg,var(--primary),var(--secondary));
color:#fff;padding:20px;text-align:center;border-radius:0 0 25px 25px}

.container{max-width:800px;margin:auto;padding:15px}
.card{background:#fff;border-radius:20px;padding:20px;margin-bottom:20px;
box-shadow:0 8px 20px rgba(0,0,0,.05)}

.hidden{display:none}

/* Ø§Ù„Ù…Ù†ØµØ© */
.podium{display:flex;justify-content:center;align-items:flex-end;
gap:10px;height:200px}
.podium-item{display:flex;flex-direction:column;align-items:center;width:30%}
.rank-box{width:100%;border-radius:15px 15px 0 0;
display:flex;flex-direction:column;align-items:center;justify-content:center;
color:#fff;font-weight:900}
.rank-1{height:140px;background:var(--gold)}
.rank-2{height:100px;background:var(--silver)}
.rank-3{height:80px;background:var(--bronze)}
.player-name{font-weight:bold;font-size:.9rem}

/* Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
table{width:100%;border-collapse:collapse}
th,td{text-align:center;padding:12px}
th{background:#f8fafc}
.diff-pos{background:#e6fffa;color:#065f46;padding:4px 8px;border-radius:6px}
.diff-neg{background:#fff5f5;color:#742a2a;padding:4px 8px;border-radius:6px}

/* ÙÙˆØ±Ù… */
input,select,button{width:100%;padding:12px;border-radius:10px;
border:1px solid #ddd;font-family:Cairo}
.btn{font-weight:900;cursor:pointer}
.btn-add{background:var(--primary);color:#fff}
.btn-del{background:none;border:none;color:var(--danger);cursor:pointer}

/* ØªÙ†Ù‚Ù„ */
.nav-bar{position:fixed;bottom:0;width:100%;display:flex;background:#fff}
.nav-link{flex:1;text-align:center;padding:15px;color:#999;font-weight:bold}
.nav-link.active{color:var(--primary);border-top:3px solid var(--primary)}
</style>
</head>

<body>

<header>
<h2>ğŸ† Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¯ÙˆÙ…Ù†Ø© Ø§Ù„Ù…Ù„ÙƒÙŠ</h2>
</header>

<div class="container">

<!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginPage" class="card">
<h3>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±</h3>
<input id="loginEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
<br><br>
<input id="loginPass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<br><br>
<button class="btn btn-add" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<!-- Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
<div id="homePage" class="page hidden">

<div class="podium" id="podiumUI"></div>

<div class="card">
<h3>ğŸ“Š Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ø§Ù…</h3>
<table>
<thead>
<tr><th>#</th><th>Ø§Ù„Ù„Ø§Ø¹Ø¨</th><th>ÙÙˆØ²</th><th>Ø®Ø³Ø§Ø±Ø©</th><th>Ø§Ù„Ù…Ø­ØµÙ„Ø©</th></tr>
</thead>
<tbody id="leaderboardBody"></tbody>
</table>
</div>

</div>

<!-- Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© -->
<div id="adminPage" class="page hidden">

<div class="card">
<h3>âš™ï¸ Ø¥Ø¶Ø§ÙØ© Ù†ØªÙŠØ¬Ø©</h3>
<input type="date" id="adminDate">
<br><br>
<select id="adminPlayer"></select>
<br><br>
<input id="adminWin" type="number" placeholder="ÙÙˆØ²">
<br><br>
<input id="adminLoss" type="number" placeholder="Ø®Ø³Ø§Ø±Ø©">
<br><br>
<button class="btn btn-add" onclick="addRecord()">Ø­ÙØ¸</button>
</div>

<div class="card">
<h3>ğŸ‘¤ Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨</h3>
<input id="newPlayer" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨">
<br><br>
<button class="btn btn-add" onclick="addPlayer()">Ø¥Ø¶Ø§ÙØ©</button>
</div>

</div>

</div>

<nav class="nav-bar hidden" id="navBar">
<div class="nav-link active" onclick="switchTab('homePage',this)">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
<div class="nav-link" onclick="switchTab('adminPage',this)">ğŸ› ï¸ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
</nav>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {getFirestore,collection,addDoc,getDocs,query,orderBy,onSnapshot,deleteDoc,doc} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import {getAuth,signInWithEmailAndPassword,onAuthStateChanged} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig={
 apiKey:"AIzaSyDJS8QCZRfa72Vl8NZxFZcLY-ee0CFILzw",
 authDomain:"koster-499c0.firebaseapp.com",
 projectId:"koster-499c0"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);
const auth=getAuth(app);

/* ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ */
window.login=()=>{
 const e=loginEmail.value,p=loginPass.value;
 signInWithEmailAndPassword(auth,e,p)
 .catch(()=>alert("Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©"));
};

/* Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
onAuthStateChanged(auth,user=>{
 if(user){
  loginPage.classList.add("hidden");
  homePage.classList.remove("hidden");
  adminPage.classList.remove("hidden");
  navBar.classList.remove("hidden");
  loadPlayers();
 }
});

/* ØªÙ†Ù‚Ù„ */
window.switchTab=(id,el)=>{
 document.querySelectorAll(".page").forEach(p=>p.classList.add("hidden"));
 document.getElementById(id).classList.remove("hidden");
 document.querySelectorAll(".nav-link").forEach(l=>l.classList.remove("active"));
 el.classList.add("active");
};

/* Ù„Ø§Ø¹Ø¨ÙŠÙ† */
async function loadPlayers(){
 const snap=await getDocs(collection(db,"players"));
 adminPlayer.innerHTML="";
 snap.forEach(d=>{
  adminPlayer.innerHTML+=`<option>${d.data().name}</option>`;
 });
}

/* Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨ */
window.addPlayer=async()=>{
 const name=newPlayer.value.trim();
 if(!name)return;
 const snap=await getDocs(collection(db,"players"));
 if(snap.docs.some(d=>d.data().name===name))
  return alert("Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…ÙˆØ¬ÙˆØ¯");
 await addDoc(collection(db,"players"),{name});
 newPlayer.value="";
 loadPlayers();
};

/* Ø¥Ø¶Ø§ÙØ© Ù†ØªÙŠØ¬Ø© */
window.addRecord=async()=>{
 await addDoc(collection(db,"records"),{
  name:adminPlayer.value,
  win:+adminWin.value||0,
  loss:+adminLoss.value||0,
  ts:new Date()
 });
 adminWin.value=adminLoss.value="";
};

/* ØªØ­Ø¯ÙŠØ« Ù…Ø¨Ø§Ø´Ø± */
onSnapshot(query(collection(db,"records"),orderBy("ts","desc")),snap=>{
 let map={};
 snap.forEach(d=>{
  const r=d.data();
  if(!map[r.name])map[r.name]={w:0,l:0,d:0};
  map[r.name].w+=r.win;
  map[r.name].l+=r.loss;
  map[r.name].d+=r.win-r.loss;
 });
 updateUI(map);
});

function updateUI(map){
 const arr=Object.entries(map).map(([n,v])=>({name:n,...v}))
 .sort((a,b)=>b.d-a.d);

 leaderboardBody.innerHTML="";
 arr.forEach((p,i)=>{
  leaderboardBody.innerHTML+=`
  <tr>
   <td>${i+1}</td><td>${p.name}</td>
   <td>${p.w}</td><td>${p.l}</td>
   <td><span class="${p.d>=0?'diff-pos':'diff-neg'}">${p.d}</span></td>
  </tr>`;
 });

 podiumUI.innerHTML="";
 [{i:1,r:2},{i:0,r:1},{i:2,r:3}].forEach(o=>{
  if(arr[o.i])podiumUI.innerHTML+=`
  <div class="podium-item">
   <div class="player-name">${arr[o.i].name}</div>
   <div class="rank-box rank-${o.r}">${o.r}</div>
  </div>`;
 });
}
</script>

</body>
</html>
